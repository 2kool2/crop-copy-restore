// Crop copy responsively, to user specified number of lines, then restore onclick via a typed animation - v1.0 - 08/01/2017 - M.J.Foskett - https://websemantics.uk/
var cropCopyRestore=function(m,u){function q(a,d){function c(f){if(!1!==b){m.requestAnimationFrame(c,d);var g=f-h;160>g&&(b=a(g));h=f}}var b,h=+new Date;c(h)}function n(a,d){a.setAttribute("aria-expanded",d);a.transitioning=!1}function v(a){var d=a.remainerTxt.split(" "),c=0;m.requestAnimationFrame(function(){a.textContent=a.croppedTxt;q(function(){a.textContent+=d[c]+" ";if(c>=d.length-1)return n(a,!0),!1;c+=1})})}function w(a){var d=a.remainerTxt.split(" "),c=d.length;q(function(){--c;var b;b=a.textContent;b=b.substring(0,b.lastIndexOf(" "+d[c]));a.textContent=b;if(0>=c)return a.textContent=a.croppedTxt+"\u2026",n(a,!1),!1})}function p(a){var d=a.target;d.transitioning||(d.transitioning=!0,"true"===d.getAttribute("aria-expanded")?w(d):v(d));a.preventDefault()}function r(a){13!==a.which&&32!==a.which||p(a)}function t(){for(var a=u.querySelectorAll("[data-cropCopyRestore]"),d=a.length,c;d--;){c=a[d];if(c.fullTxt){var b=c;b.removeEventListener("click",p);b.removeEventListener("keydown",r)}else{var b=c,h=d,f=b.getAttribute("data-cropCopyRestore");b.noOfLines=/^([1-9]\d*)$/.test(f)?f:"1";b.fullTxt=b.textContent;b.setAttribute("id",b.id||"cropCopyRestore_btn-"+h);b.setAttribute("role","button");b.setAttribute("tabindex","0");b.setAttribute("aria-controls",b.id)}n(c,!1);var b=c,g,h=c,f=h.fullTxt.split(" "),l=1,e;e=h;g=f[0]+" ";var k=e.cloneNode(!0);k.setAttribute("class",e.className+" -clone");k.textContent=g;e.parentNode.insertBefore(k,e.nextSibling);k.initialHeight=k.clientHeight;e=k;for(g=1;g<f.length;g++){e.textContent+=f[g]+"\u2026";if(e.clientHeight!==e.initialHeight){if(l+""===h.noOfLines){l=e.textContent;f=l.substring(0,l.lastIndexOf(f[g]+"\u2026"));e.textContent=f;break}l++;e.initialHeight=e.clientHeight}k=e.textContent.replace(f[g]+"\u2026",f[g]+" ");e.textContent=k}f=e.textContent.replace(/[ .,!?:;"\u201c\u2018'\-]+$/,"");e.textContent=f;h.parentNode.removeChild(e);b.croppedTxt=e.textContent;c.remainerTxt=c.fullTxt.replace(c.croppedTxt,"");c.textContent=c.croppedTxt+"\u2026";c.addEventListener("click",p,!1);c.addEventListener("keydown",r,!1)}}t();m.addEventListener("resize",function(a,d,c){var b;return function(){var h=this,f=arguments,g=c&&!b;clearTimeout(b);b=setTimeout(function(){b=null;c||a.apply(h,f)},d||200);g&&a.apply(h,f)}}(t,100,!1),!1)}(window,document);

window.addEventListener("load",cropCopyRestore,!1);
